<h1>User Profile</h1>
<%= cl_image_tag @user.photo.key, alt:"profile image", style:"max-width: 100px; max-height: 100px; margin-bottom: 10px;", alt:"profile image", style:"max-width: 100px; max-height: 100px; margin-bottom: 10px;" %>
<style>
  img {
    border-radius: 50%;
    object-fit: cover;
    height: 100px;
    width: 100px;
  }
</style>
<p><strong>Name:</strong> <%= @user.email.split('@').first %></p>
<p><strong>Account Created:</strong> <%= @user.created_at.to_date %></p>
<p><strong>Email:</strong> <%= @user.email %></p>

<% if @listings.nil? %>
  <p>No listings found.</p>
<% elsif @listings.any? { |listing| !listing.reviews.empty? } %>
  <% sum = 0 %>
  <% count = 0 %>
  <% @listings.each do |listing| %>
    <% if !listing.reviews.empty? %>
      <% sum += listing.average_rating.to_f %>
      <% count += 1 %>
    <% end %>
  <% end %>
  <p><strong>Overall average rating:</strong> <%= (sum/count).round(2) %></p>
<% else %>
  <p>No reviews for this User</p>
<% end %>

<h2>Listings</h2>
<% if @listings.nil? %>
  <p>No listings found.</p>
<% else %>
  <ul>
    <% @listings.each do |listing| %>
      <li>
        <%= link_to listing.name, product_path(listing) %>
        <%= link_to "Edit", edit_product_path(listing), class: "btn btn-primary" %>
        <%= link_to "Delete", product_path(listing.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
      </li>
    <% end %>
  </ul>
<% end %>

<h2>Bookings</h2>
<% if @bookings.nil? %>
  <p>No bookings found.</p>
<% else %>
  <ul>
    <% @bookings.each do |booking| %>
      <li>
        <%= link_to booking.product.name, product_path(booking.product) %>
        <%= link_to "Cancel Booking", product_booking_path(booking.product, booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: "btn btn-danger" %>
        </li>
    <% end %>
  </ul>
<% end %>
